# 电商订单管理模块开发计划

## 一、数据库设计
1. **店铺表（express_shop）**
   - 字段：shop_id, shop_name, platform_type, auth_key, valid_start, valid_end, status, create_by, create_time, update_by, update_time, remark
   - 关联：与sys_user表通过中间表express_user_shop建立多对多关系

2. **订单表（express_order）**
   - 字段：order_id, order_no, shop_id, product_info, receiver_name, receiver_phone, receiver_address, amount, order_status, express_no, print_status, create_by, create_time, update_by, update_time

3. **打印日志表（express_print_log）**
   - 字段：log_id, order_id, print_by, print_time, express_no

4. **打印字段表（express_field）**
   - 字段：field_id, field_code, field_name, field_type, is_required, create_by, create_time

5. **打印模板表（express_template）**
   - 字段：template_id, template_name, shop_id, template_json, is_default, create_by, create_time, update_by, update_time

6. **物流轨迹表（express_logistics_trajectory）**
   - 字段：trajectory_id, order_id, express_no, logistics_company, node_time, node_location, node_status, create_time

## 二、后端开发

### 1. 店铺管理模块
- **实体类**：`ExpressShop`、`ExpressUserShop`
- **Mapper**：`ExpressShopMapper`、`ExpressUserShopMapper`
- **Service**：`IExpressShopService`、`ExpressShopServiceImpl`
- **Controller**：`ExpressShopController`
- **功能**：店铺新增、编辑、删除、启用/禁用、列表查询、授权校验

### 2. 订单管理模块
- **实体类**：`ExpressOrder`、`ExpressPrintLog`
- **Mapper**：`ExpressOrderMapper`、`ExpressPrintLogMapper`
- **Service**：`IExpressOrderService`、`ExpressOrderServiceImpl`、`IExpressPrintLogService`、`ExpressPrintLogServiceImpl`
- **Controller**：`ExpressOrderController`
- **功能**：订单同步（异步）、订单导出、订单导入、批量打印、订单列表查询

### 3. 模板管理模块
- **实体类**：`ExpressField`、`ExpressTemplate`
- **Mapper**：`ExpressFieldMapper`、`ExpressTemplateMapper`
- **Service**：`IExpressFieldService`、`ExpressFieldServiceImpl`、`IExpressTemplateService`、`ExpressTemplateServiceImpl`
- **Controller**：`ExpressFieldController`、`ExpressTemplateController`
- **功能**：打印字段维护、模板自定义、模板预览、模板关联店铺

### 4. 寄快递模块
- **工具类**：`ExpressNoGenerator`（生成唯一快递单号）
- **Service**：扩展`IExpressOrderService`，增加生成快递单号和更新订单状态的方法
- **Controller**：扩展`ExpressOrderController`，增加生成快递单号接口

### 5. 物流轨迹模块
- **实体类**：`ExpressLogisticsTrajectory`
- **Mapper**：`ExpressLogisticsTrajectoryMapper`
- **Service**：`IExpressLogisticsTrajectoryService`、`ExpressLogisticsTrajectoryServiceImpl`
- **Controller**：`ExpressLogisticsTrajectoryController`
- **功能**：物流轨迹查询、轨迹展示、轨迹导出

## 三、前端开发

### 1. 店铺管理页面
- **路径**：system/shop
- **组件**：ShopList.vue、ShopForm.vue
- **功能**：店铺列表展示、新增/编辑店铺表单、启用/禁用开关、分页查询

### 2. 订单管理页面
- **路径**：express/order
- **组件**：OrderList.vue、OrderForm.vue
- **功能**：订单列表展示、订单同步按钮、导出/导入功能、批量打印按钮

### 3. 模板管理页面
- **路径**：express/template
- **组件**：FieldList.vue、TemplateList.vue、TemplateDesign.vue
- **功能**：打印字段维护、模板列表、模板设计器（拖拽功能）、模板预览

### 4. 物流轨迹页面
- **路径**：express/logistics
- **组件**：LogisticsList.vue、LogisticsDetail.vue
- **功能**：物流轨迹查询、轨迹时间线展示

## 四、权限配置
1. **菜单配置**：在sys_menu表中新增各模块的菜单
2. **按钮权限**：配置各模块的按钮权限（新增、编辑、删除、同步等）
3. **数据权限**：对店铺和订单模块添加数据权限控制

## 五、开发顺序
1. 数据库表设计和初始化SQL
2. 后端实体类、Mapper、Service、Controller开发
3. 前端页面开发
4. 权限配置
5. 测试和调试

## 六、技术要点
1. **异步处理**：订单同步接口使用@Async注解
2. **事务管理**：批量操作添加@Transactional注解
3. **权限控制**：集成若依的@DataScope注解和权限体系
4. **Excel处理**：复用若依的Excel导出工具类
5. **异步日志**：关键操作添加@Log注解记录操作日志
6. **分布式锁**：快递单号生成使用分布式锁防止重复

## 七、文件组织
- **后端**：所有文件放在ruoyi-express模块下，按功能模块分包
- **前端**：所有页面放在ruoyi-ui/src/views/express目录下，按功能模块分目录
- **枚举类型**：定义在ruoyi-common模块的com.ruoyi.common.enums包下
- **SQL脚本**：放在ruoyi-express/src/main/resources/sql目录下

## 八、依赖管理
- 后端：ruoyi-common、ruoyi-system
- 前端：ElementUI、若依框架的基础组件、vuedraggable（拖拽功能）