<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace 必须和 Mapper 接口全类名一致 -->
<mapper namespace="com.ruoyi.express.mapper.WaybillTemplateMapper">

    <!-- 通用查询列（复用，避免重复写字段） -->
    <sql id="selectWaybillTemplateColumns">
        id, template_name, template_code, logo_url, template_json,
        paper_size, scope_type, status, create_by, create_time,
        update_by, update_time, del_flag
    </sql>

    <!-- 结果映射（可选，若实体字段和表字段完全一致可省略，这里为了规范保留） -->
    <resultMap type="com.ruoyi.express.domain.WaybillTemplate" id="WaybillTemplateResult">
        <id     property="id"             column="id"             />
        <result property="templateName"   column="template_name"   />
        <result property="templateCode"   column="template_code"   />
        <result property="logoUrl"        column="logo_url"        />
        <result property="templateJson"   column="template_json"   />
        <result property="paperSize"      column="paper_size"      />
        <result property="scopeType"      column="scope_type"      />
        <result property="status"         column="status"         />
        <result property="createBy"       column="create_by"       />
        <result property="createTime"     column="create_time"     />
        <result property="updateBy"       column="update_by"       />
        <result property="updateTime"     column="update_time"     />
        <result property="delFlag"        column="del_flag"        />
    </resultMap>

    <!-- 1. 根据ID查询面单模板 -->
    <select id="selectWaybillTemplateById" parameterType="Long" resultMap="WaybillTemplateResult">
        select <include refid="selectWaybillTemplateColumns" />
        from express_waybill_template
        where id = #{id} and del_flag = '0'
    </select>

    <!-- 2. 查询面单模板列表（支持条件过滤+分页，若依PageHelper自动处理分页） -->
    <select id="selectWaybillTemplateList" parameterType="com.ruoyi.express.domain.WaybillTemplate" resultMap="WaybillTemplateResult">
        select <include refid="selectWaybillTemplateColumns" />
        from express_waybill_template
        <where>
            AND del_flag = '0'
            <if test="templateName != null and templateName != ''">
                and template_name like concat('%', #{templateName}, '%')
            </if>
            <if test="templateCode != null and templateCode != ''">
                and template_code like concat('%', #{templateCode}, '%')
            </if>
            <if test="status != null and status != ''">
                and status = #{status}
            </if>
            <if test="scopeType != null and scopeType != ''">
                and scope_type = #{scopeType}
            </if>
        </where>
        order by create_time desc
    </select>

    <!-- 3. 新增面单模板 -->
    <insert id="insertWaybillTemplate" parameterType="com.ruoyi.express.domain.WaybillTemplate" useGeneratedKeys="true" keyProperty="id">
        insert into express_waybill_template
        (
            template_name, template_code, logo_url, template_json,
            paper_size, scope_type, status, create_by, create_time,
            update_by, update_time, del_flag
        )
        values
            (
                #{templateName}, #{templateCode}, #{logoUrl}, #{templateJson},
                #{paperSize}, #{scopeType}, #{status}, #{createBy}, #{createTime},
                #{updateBy}, #{updateTime}, #{delFlag}
            )
    </insert>

    <!-- 4. 修改面单模板 -->
    <update id="updateWaybillTemplate" parameterType="com.ruoyi.express.domain.WaybillTemplate">
        update express_waybill_template
        <set>
            <if test="templateName != null and templateName != ''">
                template_name = #{templateName},
            </if>
            <if test="templateCode != null and templateCode != ''">
                template_code = #{templateCode},
            </if>
            <if test="logoUrl != null">
                logo_url = #{logoUrl},
            </if>
            <if test="templateJson != null and templateJson != ''">
                template_json = #{templateJson},
            </if>
            <if test="paperSize != null and paperSize != ''">
                paper_size = #{paperSize},
            </if>
            <if test="scopeType != null and scopeType != ''">
                scope_type = #{scopeType},
            </if>
            <if test="status != null and status != ''">
                status = #{status},
            </if>
            update_by = #{updateBy},
            update_time = #{updateTime}
        </set>
        where id = #{id} and del_flag = '0'
    </update>

    <!-- 5. 根据ID删除面单模板（逻辑删除，更新del_flag） -->
    <update id="deleteWaybillTemplateById" parameterType="Long">
        update express_waybill_template
        set del_flag = '1'
        where id = #{id}
    </update>

    <!-- 6. 批量删除面单模板（逻辑删除） -->
    <update id="deleteWaybillTemplateByIds" parameterType="Long[]">
        update express_waybill_template
        set del_flag = '1'
        where id in
        <foreach collection="array" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </update>

</mapper>
